; =============================================================================
; Payphone-AI Per-Service Routing Dialplan
; =============================================================================
;
; Routes dialed numbers to the payphone-app via AudioSocket, encoding the
; dialed extension into the UUID field as EXTEN:UNIQUEID. The Python side
; parses this to route directly to the correct feature/service.
;
; Installation:
;   1. Copy to /etc/asterisk/ or append to extensions_custom.conf
;   2. Reload dialplan: asterisk -rx "dialplan reload"
;   3. Point the HT801 ATA to this context
;
; HT801 ATA dial plan should be: { x+ | *x+ | #x+ }
;   This allows any digit sequence to be sent.
;
; All routing logic stays in Python. This dialplan just forwards whatever
; was dialed, encoded in the AudioSocket UUID field.
;

[payphone-incoming]
; Handset pickup, no digits dialed -> operator
exten => s,1,Answer()
 same => n,Set(CHANNEL(audioreadformat)=slin16)
 same => n,Set(CHANNEL(audiowriteformat)=slin16)
 same => n,AudioSocket(operator:${UNIQUEID},10.10.10.10:9092)
 same => n,Hangup()

; Single digit (0-9) shortcuts
exten => _X,1,Answer()
 same => n,Set(CHANNEL(audioreadformat)=slin16)
 same => n,Set(CHANNEL(audiowriteformat)=slin16)
 same => n,AudioSocket(${EXTEN}:${UNIQUEID},10.10.10.10:9092)
 same => n,Hangup()

; Any multi-digit number (2+ digits)
exten => _XX.,1,Answer()
 same => n,Set(CHANNEL(audioreadformat)=slin16)
 same => n,Set(CHANNEL(audiowriteformat)=slin16)
 same => n,AudioSocket(${EXTEN}:${UNIQUEID},10.10.10.10:9092)
 same => n,Hangup()

; Invalid extension handler
exten => i,1,Answer()
 same => n,Set(CHANNEL(audioreadformat)=slin16)
 same => n,Set(CHANNEL(audiowriteformat)=slin16)
 same => n,AudioSocket(invalid:${UNIQUEID},10.10.10.10:9092)
 same => n,Hangup()
